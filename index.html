<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Tracker CLI</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0c0c0c;
            color: #00ff00;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .terminal {
            max-width: 1200px;
            margin: 0 auto;
            background: #000;
            border: 2px solid #333;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }
        
        .terminal-header {
            background: #1a1a1a;
            padding: 10px 15px;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .terminal-button.close { background: #ff5f56; }
        .terminal-button.minimize { background: #ffbd2e; }
        .terminal-button.maximize { background: #27c93f; }
        
        .terminal-title {
            margin-left: 10px;
            color: #666;
            font-size: 12px;
        }
        
        .terminal-body {
            padding: 20px;
        }
        
        .prompt {
            color: #00ff00;
        }
        
        .prompt::before {
            content: '$ ';
            color: #0f0;
        }
        
        .output {
            margin: 10px 0;
        }
        
        .section-header {
            color: #00ffff;
            font-weight: 700;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #333;
        }
        
        .data-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            padding: 3px 0;
        }
        
        .data-label {
            color: #888;
        }
        
        .data-value {
            color: #00ff00;
            font-weight: 700;
        }
        
        .warning {
            color: #ffff00;
        }
        
        .error {
            color: #ff0000;
        }
        
        .success {
            color: #00ff00;
        }
        
        .info {
            color: #00ffff;
        }
        
        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #00ff00;
            animation: blink 1s infinite;
            margin-left: 5px;
        }
        
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }
        
        .command-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            outline: none;
            width: 100%;
            margin-top: 10px;
        }
        
        .loading {
            color: #ffff00;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .ascii-art {
            color: #00ffff;
            font-size: 10px;
            line-height: 1.2;
            margin: 10px 0;
        }
        
        .timestamp {
            color: #666;
            font-size: 12px;
        }
        
        hr {
            border: none;
            border-top: 1px dashed #333;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <span class="terminal-button close"></span>
            <span class="terminal-button minimize"></span>
            <span class="terminal-button maximize"></span>
            <span class="terminal-title">flight-tracker@lahore:~</span>
        </div>
        <div class="terminal-body">
            <div class="ascii-art">
    __|__
--o--o--  FLIGHT & WEATHER MONITORING SYSTEM v2.1
  -'-'-   Lahore Airspace Intelligence Terminal
            </div>
            
            <div class="output">
                <div class="prompt">./start-monitoring.sh --location=lahore --auto-refresh</div>
                <div class="timestamp" id="init-time"></div>
            </div>
            
            <div id="output-container"></div>
            
            <div class="prompt" style="margin-top: 20px;">
                <input type="text" class="command-input" id="command-input" placeholder="Type 'refresh' to update data, 'help' for commands">
            </div>
        </div>
    </div>

    <script>
        const LAT = 31.5204;
        const LON = 74.3587;
        let autoRefreshInterval;

        function getTimestamp() {
            return new Date().toLocaleString('en-US', { 
                timeZone: 'Asia/Karachi',
                hour12: false 
            });
        }

        document.getElementById('init-time').textContent = `[${getTimestamp()}] System initialized`;

        async function fetchFlightData() {
            const output = document.getElementById('output-container');
            output.innerHTML += `<div class="loading">[${getTimestamp()}] Scanning airspace</div>`;
            
            try {
                const response = await fetch(
                    `https://opensky-network.org/api/states/all?lamin=${LAT-0.5}&lomin=${LON-0.5}&lamax=${LAT+0.5}&lomax=${LON+0.5}`
                );
                
                if (!response.ok) throw new Error('API connection failed');
                
                const data = await response.json();
                return data.states && data.states.length > 0 ? data.states[0] : null;
                
            } catch (error) {
                return { error: error.message };
            }
        }

        async function fetchWeatherData() {
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,wind_gusts_10m&timezone=Asia/Karachi`
                );
                
                if (!response.ok) throw new Error('Weather API failed');
                
                const data = await response.json();
                return data.current;
                
            } catch (error) {
                return { error: error.message };
            }
        }

        function getWeatherDescription(code) {
            const codes = {
                0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
                45: 'Foggy', 48: 'Depositing rime fog',
                51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle',
                61: 'Slight rain', 63: 'Moderate rain', 65: 'Heavy rain',
                71: 'Slight snow', 73: 'Moderate snow', 75: 'Heavy snow',
                80: 'Slight rain showers', 81: 'Moderate rain showers', 82: 'Violent rain showers',
                95: 'Thunderstorm', 96: 'Thunderstorm with hail'
            };
            return codes[code] || 'Unknown';
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 
                              'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            const index = Math.round(degrees / 22.5) % 16;
            return directions[index];
        }

        async function displayData() {
            const output = document.getElementById('output-container');
            output.innerHTML = '';
            
            output.innerHTML += `<div class="success">[${getTimestamp()}] === DATA REFRESH INITIATED ===</div><hr>`;
            
            // Fetch both data sources
            const [flight, weather] = await Promise.all([fetchFlightData(), fetchWeatherData()]);
            
            // Display Weather Data
            output.innerHTML += `<div class="section-header">╔═══ WEATHER CONDITIONS ═══╗</div>`;
            
            if (weather.error) {
                output.innerHTML += `<div class="error">ERROR: ${weather.error}</div>`;
            } else {
                output.innerHTML += `
                    <div class="data-row">
                        <span class="data-label">Location:</span>
                        <span class="data-value">Lahore, Punjab, Pakistan</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Temperature:</span>
                        <span class="data-value">${weather.temperature_2m}°C (Feels like ${weather.apparent_temperature}°C)</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Humidity:</span>
                        <span class="data-value">${weather.relative_humidity_2m}%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Conditions:</span>
                        <span class="data-value">${getWeatherDescription(weather.weather_code)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Cloud Cover:</span>
                        <span class="data-value">${weather.cloud_cover}%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Pressure:</span>
                        <span class="data-value">${weather.pressure_msl} hPa</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Wind Speed:</span>
                        <span class="data-value">${weather.wind_speed_10m} km/h (${(weather.wind_speed_10m * 0.539957).toFixed(1)} knots)</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Wind Direction:</span>
                        <span class="data-value">${weather.wind_direction_10m}° ${getWindDirection(weather.wind_direction_10m)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Wind Gusts:</span>
                        <span class="data-value">${weather.wind_gusts_10m} km/h</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Precipitation:</span>
                        <span class="data-value">${weather.precipitation} mm</span>
                    </div>
                `;
            }
            
            output.innerHTML += `<hr>`;
            
            // Display Flight Data
            output.innerHTML += `<div class="section-header">╔═══ AIRCRAFT DETECTION ═══╗</div>`;
            
            if (flight && flight.error) {
                output.innerHTML += `<div class="error">ERROR: ${flight.error}</div>`;
            } else if (!flight) {
                output.innerHTML += `<div class="warning">NO AIRCRAFT DETECTED IN MONITORING RANGE</div>`;
                output.innerHTML += `<div class="info">Monitoring radius: ~100km from Lahore</div>`;
            } else {
                const callsign = flight[1] ? flight[1].trim() : 'UNKNOWN';
                const country = flight[2] || 'Unknown';
                const velocity = flight[9] || 0;
                const altitude = flight[7] || 0;
                const latitude = flight[6] || 0;
                const longitude = flight[5] || 0;
                const verticalRate = flight[11] || 0;
                
                const speedKmh = (velocity * 3.6).toFixed(0);
                const speedKnots = (velocity * 1.94384).toFixed(0);
                
                let category = 'UNKNOWN';
                if (altitude < 3000) category = 'LOW ALTITUDE';
                else if (altitude < 7000) category = 'MEDIUM ALTITUDE';
                else category = 'CRUISE ALTITUDE';
                
                let status = 'LEVEL FLIGHT';
                if (verticalRate > 1) status = 'CLIMBING';
                else if (verticalRate < -1) status = 'DESCENDING';
                
                output.innerHTML += `
                    <div class="data-row">
                        <span class="data-label">Callsign:</span>
                        <span class="data-value">${callsign}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Country of Origin:</span>
                        <span class="data-value">${country}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Category:</span>
                        <span class="data-value">${category}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Flight Status:</span>
                        <span class="data-value">${status}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Altitude:</span>
                        <span class="data-value">${altitude.toFixed(0)} meters (${(altitude * 3.28084).toFixed(0)} feet)</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Ground Speed:</span>
                        <span class="data-value">${speedKmh} km/h</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Speed (knots):</span>
                        <span class="data-value">${speedKnots} kts</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Vertical Rate:</span>
                        <span class="data-value">${verticalRate.toFixed(1)} m/s</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Position:</span>
                        <span class="data-value">${latitude.toFixed(4)}°N, ${longitude.toFixed(4)}°E</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Route Info:</span>
                        <span class="warning">UNAVAILABLE (Premium API Required)</span>
                    </div>
                `;
            }
            
            output.innerHTML += `<hr><div class="success">[${getTimestamp()}] === MONITORING ACTIVE - AUTO-REFRESH: 15s ===</div>`;
        }

        // Command input handling
        document.getElementById('command-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const cmd = this.value.toLowerCase().trim();
                const output = document.getElementById('output-container');
                
                output.innerHTML += `<div class="prompt">$ ${this.value}</div>`;
                
                if (cmd === 'refresh') {
                    displayData();
                } else if (cmd === 'help') {
                    output.innerHTML += `
                        <div class="info">Available commands:</div>
                        <div class="data-row"><span class="data-label">refresh</span><span>Update flight and weather data</span></div>
                        <div class="data-row"><span class="data-label">clear</span><span>Clear terminal output</span></div>
                        <div class="data-row"><span class="data-label">help</span><span>Show this help message</span></div>
                    `;
                } else if (cmd === 'clear') {
                    output.innerHTML = '';
                } else if (cmd) {
                    output.innerHTML += `<div class="error">Command not found: ${cmd}</div>`;
                }
                
                this.value = '';
                this.scrollIntoView({ behavior: 'smooth' });
            }
        });

        // Initial load
        displayData();
        
        // Auto-refresh every 15 seconds
        autoRefreshInterval = setInterval(displayData, 15000);
    </script>
</body>
</html>